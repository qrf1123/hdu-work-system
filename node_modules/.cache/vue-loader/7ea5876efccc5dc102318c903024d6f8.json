{"remainingRequest":"/Users/chenrixin/HDUWorkStudy/Mobile/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenrixin/HDUWorkStudy/Mobile/src/views/teacher/publish/Form.vue?vue&type=style&index=0&id=2049d0b3&scoped=true&lang=css&","dependencies":[{"path":"/Users/chenrixin/HDUWorkStudy/Mobile/src/views/teacher/publish/Form.vue","mtime":1619342123808},{"path":"/Users/chenrixin/HDUWorkStudy/Mobile/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenrixin/HDUWorkStudy/Mobile/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/chenrixin/HDUWorkStudy/Mobile/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/chenrixin/HDUWorkStudy/Mobile/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenrixin/HDUWorkStudy/Mobile/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi52YW4tYnV0dG9uIHsKICAgIHdpZHRoOiA5NSU7CiAgICBtYXJnaW46IDE1cHggYXV0bzsKfQo="},{"version":3,"sources":["Form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoSA;AACA;AACA;AACA","file":"Form.vue","sourceRoot":"src/views/teacher/publish","sourcesContent":["<template>\n    <div>\n        <top-nav :title=\"title\" :isShow=\"true\" />\n        <van-form @submit=\"onSubmit\">\n            <van-field required disabled readonly v-if=\"false\" v-model=\"flowID\" label=\"流程ID\" rows=\"1\"  type=\"digit\" />\n            <van-field required v-model=\"model.flowName\" label=\"流程标题\" rows=\"1\" autosize clearable type=\"textarea\" placeholder=\"学院/部门+教师全名+工号\"/>\n            <van-field required disabled v-if=\"false\"  label=\"流程类型\" rows=\"1\"   type=\"text\" placeholder=\"用工申请\"/>\n            <van-field required name=\"radio\" label=\"学生类别\">\n                <template #input>\n                    <van-radio-group v-model=\"studentType\" direction=\"horizontal\">\n                        <van-radio name=\"1\">本科生</van-radio>\n                        <van-radio name=\"2\">研究生</van-radio>\n                    </van-radio-group>\n                </template>\n            </van-field>\n\n            <van-field v-if=\"studentType == 1?true:false\" required readonly clickable name=\"pickerStationType1\" :value=\"value2\" label=\"岗位类别\" placeholder=\"点击选择岗位类型\" @click=\"showPickerStationType1 = true\"/>\n            <van-popup v-model=\"showPickerStationType1\" position=\"bottom\">\n                <van-picker show-toolbar :columns=\"stationTypes1\" @confirm=\"onConfirmStationType\" @cancel=\"showPickerStationType1 = false\"/>\n            </van-popup>\n            <van-field v-if=\"studentType == 2?true:false\" required readonly clickable name=\"pickerStationType2\" :value=\"value2\" label=\"岗位类别\" placeholder=\"点击选择岗位类型\" @click=\"showPickerStationType2 = true\"/>\n            <van-popup v-model=\"showPickerStationType2\" position=\"bottom\">\n                <van-picker show-toolbar :columns=\"stationTypes2\" @confirm=\"onConfirmStationType\" @cancel=\"showPickerStationType2 = false\"/>\n            </van-popup>\n            <!-- 本科生的岗位 输入 岗位名称 -->\n            <van-field v-if=\"studentType == 1 ? true : false \" required v-model=\"model.flowData.stationName\" label=\"岗位名称\" rows=\"1\" autosize clearable type=\"textarea\" placeholder=\"岗位名称\"/>\n\n            <!-- 研究生的岗位名称 四选一 -->\n\n            <van-field v-if=\"studentType == 2?true:false\" required readonly clickable name=\"pickerStationName\" :value=\"value3\" label=\"岗位名称\" placeholder=\"点击选择岗位名称\" @click=\"showPickerStationName = true\"/>\n            <van-popup v-model=\"showPickerStationName\" position=\"bottom\">\n                <van-picker show-toolbar :columns=\"stationNames\" @confirm=\"onConfirmStationName\" @cancel=\"showPickerStationName = false\"/>\n            </van-popup>\n\n            <van-field required readonly clickable name=\"picker1\" :value=\"value1\" label=\"用工学期\" placeholder=\"点击选择学期\" @click=\"showPicker1 = true\"/>\n            <van-popup v-model=\"showPicker1\" position=\"bottom\">\n                <van-picker show-toolbar :columns=\"terms\" @confirm=\"onConfirmTerm\" @cancel=\"showPicker1 = false\"/>\n            </van-popup>\n\n            <van-field required label=\"总需人数\" v-model.number=\"model.flowData.total_num\" placeholder=\"所需人数\" type=\"text\"/>\n            <van-field required v-if=\"staffAuth1 === 1?true:false\" label=\"贫困生数\" v-model.number=\"model.flowData.poorNum\" placeholder=\"贫困生数\" type=\"digit\"/>\n            <van-field required v-if=\"staffAuth1 === 1?true:false\" label=\"校岗人数\" v-model.number=\"model.flowData.nonpoorNum\" placeholder=\"非贫困生人数\" type=\"digit\"/>\n            <van-field required v-if=\"staffAuth2 === 1?true:false\" label=\"外院人数\" v-model.number=\"model.flowData.otherDeptNum\" placeholder=\"外学院人数\" type=\"digit\"/>\n            <van-field required label=\"开始日期\" readonly clickable name=\"calendar\" :value=\"model.flowData.workStartTime\"  placeholder=\"点击选择开始日期\" @click=\"showCalendar1 = true\"/>\n            <van-calendar :min-date=\"minDate\" :max-date=\"maxDate\" color=\"rgb(81, 125, 252)\" v-model=\"showCalendar1\" @confirm=\"onConfirmStart\" :show-confirm=\"false\"/>\n            <van-field required label=\"工作内容\" v-model=\"model.flowData.stationContent\" rows=\"1\" autosize clearable type=\"textarea\" placeholder=\"工作内容\"/>\n            <van-field required label=\"工作地点\" v-model=\"model.flowData.stationLocation\" rows=\"1\" autosize clearable type=\"textarea\" placeholder=\"工作地点\"/>\n            <van-field label=\"申请说明\" v-model=\"model.flowData.remarks\"  rows=\"1\" autosize clearable type=\"textarea\" placeholder=\"申请说明\"/>\n            <!-- <van-field label=\"备注说明\" v-model=\"model.remarkContent\" rows=\"1\" autosize clearable type=\"textarea\" placeholder=\"其他说明\"/> -->\n            <van-button round block type=\"info\" native-type=\"submit\">\n                {{$route.path ==='/publishment' ? '确认提交' : '确认修改'}}\n            </van-button>\n        </van-form>\n    </div>\n</template>\n\n<script>\nimport TopNav from '@/components/common/TopNav.vue'\nexport default {\n    props: ['title','flowID','flowName'],\n    data() {\n        return {\n            studentType:0,\n            detail: {},\n            value1:'',\n            value2:'',\n            value3:'',\n            model: {\n                // flowId:'',  第一次发起申请的时候没有 不用填写这个\n                flowName:'',\n                procType:\"4\", // 4-用工申请 或者 5-工时申请\n                flowData:{\n                    termId:'',\n                    stationType:'', //岗位类别，1-一般岗，4-助教岗，5-助管岗，如不选，默认为一般岗\n                    totalNum:'',  // 总人数上限\n                    nonpoorNum:0,\n                    otherDeptNum:0,\n                    remarks:'', // 申请说明信息\n                    stationName:'',\n                    // stationType:'', //工种 老师用工申请时必填\n                    // 注意这个是 写死了\n                    deptId:'', //申请老师部门\n                    total_num:'', //用工申请人数\n                    workStartTime:'',\n                    stationContent:'', // 用工内容\n                    stationLocation: '' //用工地点\n                },\n                \n            },\n            staffAuth1:'',\n            staffAuth2:'',\n            terms: [],\n            term: '',\n            termOptions: [],\n            //本科生 选择 的 岗位类型\n            stationTypes1:[\n                {text:'固定岗',value:\"1\"},\n                {text:'临时岗',value:\"2\"},\n                {text:'假期岗',value:\"3\"},\n                {text:'本科生助教',value:\"4\"},\n                ],\n            //研究生 选择 的 岗位类型\n            stationTypes2:[\n                {text:'固定岗',value:\"1\"},\n                {text:'临时岗',value:\"2\"},\n                {text:'假期岗',value:\"3\"},\n                ],\n            //研究生 可 选择的 岗位名称   研究生助教 研究生助管 研究生助研  研究生管理员\n            stationNames:[\n                {text:'研究生助教',value:\"1\"},\n                {text:'研究生助管',value:\"2\"},\n                {text:'研究生助研',value:\"3\"},\n                {text:'研究生管理员',value:\"4\"},\n            ],\n            stationType: '',\n            jobCategory: ['固定岗','临时岗','假期岗','助教岗','研究生助教'],\n            showCalendar1: false,\n            showCalendar2: false,\n            showPicker: false,\n            showPicker1: false,\n            showPicker2: false,\n            showPickerStationName:false,\n            showPickerStationType1:false,\n            showPickerStationType2:false,\n            minDate: new Date(2020, 0, 1), // 测试日期 后端设置的测试日期范围 不在这个范围提交便会报错！\n            maxDate: new Date(2021, 11, 31), // 测试日期 后端设置的测试日期范围 不在这个范围提交便会报错！\n        }\n    },\n    components: {\n        TopNav\n    },\n    methods: {\n        getstaffAuths(){\n            this.staffAuth1 = sessionStorage.getItem('staffAuth1');\n            this.staffAuth2 = sessionStorage.getItem('staffAuth2');\n            this.model.flowData.deptId = sessionStorage.getItem('deptId')-0;\n            console.log(\"deptId:\"+this.model.flowData.deptId)\n\n        },\n        onConfirmStart(date) {\n            this.model.flowData.workStartTime = this.formatMyDate(date)\n            this.showCalendar1 = false;\n        },\n        onConfirmEnd(date) {\n            this.model.workEndTime = this.formatMyDate(date)\n            this.showCalendar2 = false;\n        },\n        onConfirmJob(value,index) {\n            this.stationType = value\n            this.model.stationType = `${index + 1}`\n            this.showPicker = false\n        },\n        onConfirmTerm(value) {\n            this.value1 = value.text\n            this.model.flowData.termId = value.value\n            this.showPicker1 = false\n        },\n        onConfirmStationType(value) {\n            this.value2= value.text;\n            this.model.flowData.stationType = value.value\n            // console.log(\"index:\"+ value.text);\n            // console.log(\"index:\"+ value.value);\n            this.showPickerStationType1 = false\n            this.showPickerStationType2 = false\n        },\n        onConfirmStationName(value) {\n            this.value3= value.text ;\n            this.model.flowData.stationType = value.text ;\n            // console.log(\"index:\"+ value.text);\n            // console.log(\"index:\"+ value.value);\n            this.showPickerStationName = false\n        },\n        async onSubmit() {\n            var isEmplty = false\n            for(let key in this.model) {\n                if(key !== 'poorNum' && key!=='nonpoorNum' && key!=='otherDeptNum' && key!=='skillQeruire' && key!=='remarkContent') {\n                    if(!this.model[key]) {\n                        this.$toast.fail('必填项不能为空!!!')\n                        isEmplty = true\n                        break\n                    }\n                }\n            }\n            if(!isEmplty) {\n                var res\n                //请求接口失败 之后再次提交 会有很多个 的用工申请 加到尾部 所以判断尾部如果是 的用工申请的 话就不再加了\n                var tempFlowName = this.model.flowName.slice(this.model.flowName.length-5,this.model.flowName.length)\n                console.log(tempFlowName);\n                if (tempFlowName !== \"的用工申请\") {\n                     this.model.flowName = this.model.flowName + \"的用工申请\";\n                }\n                 if(this.model.flowData.stationType == 4 )\n                    this.model.flowData.stationName = this.model.flowData.stationName + \"本科生助教\";\n\n                if(this.$route.path ==='/edit'){\n                    this.model.flowId = this.flowID;\n                    \n                     res = await this.$ajax.post('/system/flows/startFlow', this.model)\n                }else{\n                     res = await this.$ajax.post('/system/flows/startFlow', this.model)\n                }\n                // console.log(this.model.procType);\n                if(this.model.procType == \"4\"){\n                    console.log(123);\n                    this.model.flowData.stationName = this.model.flowData.stationName.slice(0,(this.model.flowData.stationName.length-5));\n                    this.model.flowName = this.model.flowName.slice(0,(this.model.flowName.length-5));\n                    console.log(this.model.flowData.stationName)\n                    // console.log(this.model.flowName)\n                }\n                if(res.data.code === 200) {\n                    this.$toast.success(res.data.msg)\n                    this.$router.push('/publish')\n                }else {\n                    //修改了 失败时的提示信息 \n                    this.$toast.fail(res.data.msg)\n                }\n                \n            }\n        },\n        formatMyDate(date) {\n            let year = date.getFullYear()\n            let month = date.getMonth() + 1\n            month = month < 10 ? ('0' + month) : month\n            let d = date.getDate()\n            d = d < 10 ? ('0' + d) : d\n            return `${year}-${month}-${d}`\n        },\n        getTermOptions() {\n            const year = new Date().getFullYear()\n            if(new Date().getMonth() + 1< 9) {\n                const term = `${year -1}-${year}`\n                return [`${term}第一学期`, `${term}第二学期`]\n            } else {\n                const term = `${year}-${year + 1}`\n                return [`${term}第一学期`, `${term}第二学期`]\n            }\n        },\n        deleteTail(){\n            \n            \n        },\n        //任务详情\n        async getFlowDetail(flowId){\n            const res = await this.$ajax.get('/system/flows/queryFlowData',{params:{flowId : flowId}})\n                if(res.data.code === 200){\n                    this.model.procType = \"4\";\n                    this.model.flowData.termId = res.data.data.flowData.termId\n                    this.model.flowData.stationType = res.data.data.flowData.stationType \n                    this.model.flowData.total_num = res.data.data.flowData.totalNum\n                    this.model.flowData.nonpoorNum = res.data.data.flowData.nonpoorNum \n                    this.model.flowData.otherDeptNum = res.data.data.flowData.otherDeptNum\n                    this.model.flowData.remarks = res.data.data.flowData.remarks\n                    this.model.flowData.deptId = res.data.data.flowData.deptId\n                    this.model.flowData.workStartTime = res.data.data.flowData.workStartTime.slice(0,10);\n                    this.model.flowData.stationContent = res.data.data.flowData.stationContent\n                    this.model.flowData.stationLocation = res.data.data.flowData.stationLocation \n                    console.log(res.data.data);\n                }else{\n                    console.log(res.data.msg);\n                }\n        },\n        async getTermList(){\n            const res = await this.$ajax.get('/system/term/list')\n            if(res.data.code === 200){\n                console.log(res.data.rows)\n                res.data.rows.forEach(item => {\n                    var term ={\n                       text:'',\n                       value:'' \n                    }\n                    term.text = item.termName;\n                    term.value = item.termId;\n                    console.log(term);\n                    this.terms.push(term);\n                });\n            }\n        },\n    },\n   \n    mounted() {\n        this.getTermList();\n        this.getstaffAuths();\n        if(this.$route.path === '/edit'){\n                this.getFlowDetail(this.flowID);\n                this.model.flowName = this.flowName.slice(0,this.flowName.length-5);\n            }\n    }\n    \n}\n</script>\n\n<style scoped>\n.van-button {\n    width: 95%;\n    margin: 15px auto;\n}\n</style>"]}]}